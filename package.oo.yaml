version: 0.2.1
icon: ./icon.png
scripts:
  # Script executed when the container is first loaded
  # eg: bootstrap: pip install pandas
  bootstrap: |
    set -e
    apt-get update && apt-get install libgl1 -y
    apt-get install libglib2.0-0 -y

    # Initialize git submodule for manga-image-translator
    git submodule update --init --recursive

    poetry install --no-root

    # 存在 poetry 和 pip 混用，目前没什么办法，以后优化
    pip install --upgrade pip
    if command -v nvidia-smi &> /dev/null; then
      pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu126
      pip install paddlepaddle-gpu==2.6.2
    else
      pip install paddlepaddle==2.6.2
    fi

    # Install manga-image-translator from submodule
    pip install -e ./manga
dependencies:
  oomol-file: 0.0.20
  oomol-preview: 0.1.7
  manga-tools: 0.0.8
  array: 0.1.4
  oomol-transform: 0.0.7
name: manga-translator
displayName: "%Manga Translator%"
repository: https://github.com/oomol-flows/manga-translator
description: "%key%"
releaseNotes: add layer
